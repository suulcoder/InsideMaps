{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";var _marked=_regeneratorRuntime.mark(login),_marked2=_regeneratorRuntime.mark(watchLoginStarted),_marked3=_regeneratorRuntime.mark(signup),_marked4=_regeneratorRuntime.mark(watchSignUpStarted);import{call,takeEvery,put,delay,select}from'redux-saga/effects';import*as actions from\"../actions/auth\";import*as types from\"../types/auth\";import{bodyParser}from\"../modules/parser\";var API_BASE_URL='https://inside-maps-api.herokuapp.com/api/v1/auth';function login(action){var response,_yield$response$json,token,_yield$response$json2,message;return _regeneratorRuntime.wrap(function login$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return call(fetch,\"\".concat(API_BASE_URL,\"/signin/\"),{method:'POST',body:bodyParser(action.payload),headers:{'Content-Type':'application/x-www-form-urlencoded'}});case 3:response=_context.sent;if(!(response.status===200)){_context.next=13;break;}_context.next=7;return response.json();case 7:_yield$response$json=_context.sent;token=_yield$response$json.token;_context.next=11;return put(actions.completeLogin(token));case 11:_context.next=19;break;case 13:_context.next=15;return response.json();case 15:_yield$response$json2=_context.sent;message=_yield$response$json2.message;_context.next=19;return put(actions.failLogin(message,0));case 19:_context.next=25;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](0);_context.next=25;return put(actions.failLogin('CONNECTION FAILED',0));case 25:case\"end\":return _context.stop();}}},_marked,null,[[0,21]]);}export function watchLoginStarted(){return _regeneratorRuntime.wrap(function watchLoginStarted$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return takeEvery(types.AUTHENTICATION_STARTED,login);case 2:case\"end\":return _context2.stop();}}},_marked2);}function signup(action){var response,_action$payload,email,password,data;return _regeneratorRuntime.wrap(function signup$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return call(fetch,\"\".concat(API_BASE_URL,\"/signup/\"),{method:'POST',body:JSON.stringify(action.payload),headers:{'Content-Type':'application/json'}});case 3:response=_context3.sent;if(!(response.status>=200&&response.status<=300)){_context3.next=10;break;}_action$payload=action.payload,email=_action$payload.email,password=_action$payload.password;_context3.next=8;return put(actions.startLogin(email,password));case 8:_context3.next=20;break;case 10:if(!(response.status>=500&&response.status<=600)){_context3.next=15;break;}_context3.next=13;return put(actions.failLogin('Email is already registered',1));case 13:_context3.next=20;break;case 15:_context3.next=17;return response.json();case 17:data=_context3.sent;_context3.next=20;return put(actions.failLogin(data[0].msg,1));case 20:_context3.next=27;break;case 22:_context3.prev=22;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);_context3.next=27;return put(actions.failLogin('CONNECTION FAILED',1));case 27:case\"end\":return _context3.stop();}}},_marked3,null,[[0,22]]);}export function watchSignUpStarted(){return _regeneratorRuntime.wrap(function watchSignUpStarted$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return takeEvery(types.REGISTRATION_STARTED,signup);case 2:case\"end\":return _context4.stop();}}},_marked4);}","map":{"version":3,"sources":["/home/thecoder/Documentos/UVG/Software/InsideMaps/src/sagas/auth.js"],"names":["login","watchLoginStarted","signup","watchSignUpStarted","call","takeEvery","put","delay","select","actions","types","bodyParser","API_BASE_URL","action","fetch","method","body","payload","headers","response","status","json","token","completeLogin","message","failLogin","AUTHENTICATION_STARTED","JSON","stringify","email","password","startLogin","data","msg","console","log","REGISTRATION_STARTED"],"mappings":"iGAkBUA,K,oCA4BOC,iB,oCAQPC,M,oCA8BOC,kB,EApFjB,OACEC,IADF,CAEEC,SAFF,CAGEC,GAHF,CAMEC,KANF,CAOEC,MAPF,KAQO,oBARP,CAUA,MAAO,GAAKC,CAAAA,OAAZ,uBACA,MAAO,GAAKC,CAAAA,KAAZ,qBACA,OAASC,UAAT,yBAGA,GAAMC,CAAAA,YAAY,CAAG,mDAArB,CAGA,QAAUZ,CAAAA,KAAV,CAAgBa,MAAhB,sNAGqB,MAAMT,CAAAA,IAAI,CACzBU,KADyB,WAEtBF,YAFsB,aAGzB,CACEG,MAAM,CAAE,MADV,CAEEC,IAAI,CAAEL,UAAU,CAACE,MAAM,CAACI,OAAR,CAFlB,CAGEC,OAAO,CAAE,CACP,eAAgB,mCADT,CAHX,CAHyB,CAAV,CAHrB,OAGUC,QAHV,oBAcQA,QAAQ,CAACC,MAAT,GAAoB,GAd5B,2CAewB,MAAMD,CAAAA,QAAQ,CAACE,IAAT,EAAN,CAfxB,0CAecC,KAfd,sBAecA,KAfd,kBAgBM,MAAMhB,CAAAA,GAAG,CAACG,OAAO,CAACc,aAAR,CAAsBD,KAAtB,CAAD,CAAT,CAhBN,wDAkB0B,MAAMH,CAAAA,QAAQ,CAACE,IAAT,EAAN,CAlB1B,4CAkBcG,OAlBd,uBAkBcA,OAlBd,kBAmBM,MAAMlB,CAAAA,GAAG,CAACG,OAAO,CAACgB,SAAR,CAAkBD,OAAlB,CAA0B,CAA1B,CAAD,CAAT,CAnBN,0GAuBI,MAAMlB,CAAAA,GAAG,CAACG,OAAO,CAACgB,SAAR,CAAkB,mBAAlB,CAAsC,CAAtC,CAAD,CAAT,CAvBJ,qEA4BA,MAAO,SAAUxB,CAAAA,iBAAV,iJACL,MAAMI,CAAAA,SAAS,CACbK,KAAK,CAACgB,sBADO,CAEb1B,KAFa,CAAf,CADK,wDAQP,QAAUE,CAAAA,MAAV,CAAiBW,MAAjB,uMAEqB,MAAMT,CAAAA,IAAI,CACzBU,KADyB,WAEtBF,YAFsB,aAGzB,CACEG,MAAM,CAAE,MADV,CAEEC,IAAI,CAAEW,IAAI,CAACC,SAAL,CAAef,MAAM,CAACI,OAAtB,CAFR,CAGEC,OAAO,CAAE,CACP,eAAgB,kBADT,CAHX,CAHyB,CAAV,CAFrB,OAEUC,QAFV,qBAaQA,QAAQ,CAACC,MAAT,EAAmB,GAAnB,EAA0BD,QAAQ,CAACC,MAAT,EAAmB,GAbrD,4CAcoCP,MAAM,CAACI,OAd3C,CAcgBY,KAdhB,iBAcgBA,KAdhB,CAcuBC,QAdvB,iBAcuBA,QAdvB,kBAeQ,MAAMxB,CAAAA,GAAG,CAACG,OAAO,CAACsB,UAAR,CAAmBF,KAAnB,CAA0BC,QAA1B,CAAD,CAAT,CAfR,4CAgBeX,QAAQ,CAACC,MAAT,EAAmB,GAAnB,EAA0BD,QAAQ,CAACC,MAAT,EAAmB,GAhB5D,8CAiBQ,MAAMd,CAAAA,GAAG,CAACG,OAAO,CAACgB,SAAR,CAAkB,6BAAlB,CAAgD,CAAhD,CAAD,CAAT,CAjBR,0DAmBmB,MAAMN,CAAAA,QAAQ,CAACE,IAAT,EAAN,CAnBnB,QAmBYW,IAnBZ,kCAoBM,MAAM1B,CAAAA,GAAG,CAACG,OAAO,CAACgB,SAAR,CAAkBO,IAAI,CAAC,CAAD,CAAJ,CAAQC,GAA1B,CAA8B,CAA9B,CAAD,CAAT,CApBN,6FAwBIC,OAAO,CAACC,GAAR,eAxBJ,kBAyBI,MAAM7B,CAAAA,GAAG,CAACG,OAAO,CAACgB,SAAR,CAAkB,mBAAlB,CAAsC,CAAtC,CAAD,CAAT,CAzBJ,uEA8BA,MAAO,SAAUtB,CAAAA,kBAAV,kJACL,MAAME,CAAAA,SAAS,CACbK,KAAK,CAAC0B,oBADO,CAEblC,MAFa,CAAf,CADK","sourcesContent":["import {\n  call,\n  takeEvery,\n  put,\n  // race,\n  // all,\n  delay,\n  select,\n} from 'redux-saga/effects';\n\nimport * as actions from '../actions/auth';\nimport * as types from '../types/auth';\nimport { bodyParser } from '../modules/parser';\n\n\nconst API_BASE_URL = 'https://inside-maps-api.herokuapp.com/api/v1/auth';\n\n\nfunction* login(action) {\n\n  try {\n    const response = yield call(\n      fetch,  \n      `${API_BASE_URL}/signin/`,\n      {\n        method: 'POST',\n        body: bodyParser(action.payload),\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n      },\n    );\n    if (response.status === 200) {\n      const { token } = yield response.json();\n      yield put(actions.completeLogin(token));\n    } else {\n      const { message } = yield response.json();\n      yield put(actions.failLogin(message,0));   //0 because is in login form\n    }\n\n  } catch (error) {\n    yield put(actions.failLogin('CONNECTION FAILED',0));   //0 because is in login form\n  }\n}\n\n\nexport function* watchLoginStarted() {\n  yield takeEvery(\n    types.AUTHENTICATION_STARTED,\n    login,\n  );\n}\n\n\nfunction* signup(action) {\n  try {\n    const response = yield call(\n      fetch,  \n      `${API_BASE_URL}/signup/`,\n      {\n        method: 'POST',\n        body: JSON.stringify(action.payload),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      },\n    );\n    if (response.status >= 200 && response.status <= 300) {\n        const { email, password } = action.payload;\n        yield put(actions.startLogin(email, password));\n    } else if (response.status >= 500 && response.status <= 600){\n        yield put(actions.failLogin('Email is already registered',1));\n    } else {\n      const data = yield response.json(); \n      yield put(actions.failLogin(data[0].msg,1));   //1 because is in signup form\n    }\n\n  } catch (error) {\n    console.log(error)\n    yield put(actions.failLogin('CONNECTION FAILED',1));   //1 because is in signup form\n  }\n  \n}\n\nexport function* watchSignUpStarted() {\n  yield takeEvery(\n    types.REGISTRATION_STARTED,\n    signup,\n  );\n}"]},"metadata":{},"sourceType":"module"}