{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";function _createForOfIteratorHelper(o){if(typeof Symbol===\"undefined\"||o[typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\"]==null){if(Array.isArray(o)||(o=_unsupportedIterableToArray(o))){var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var it,normalCompletion=true,didErr=false,err;return{s:function s(){it=o[typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\"]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(n);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import*as badgin from'badgin';import uuidv4 from'uuid/v4';import{guardPermission,getExponentPushTokenAsync as _getExponentPushTokenAsync,getDevicePushTokenAsync as _getDevicePushTokenAsync}from\"./ExponentNotificationsHelper.web\";import\"./ExponentNotifications.fx.web\";var currentBadgeNumber=0;function transformLocalNotification(notification,tag){var _notification$web=notification.web,web=_notification$web===void 0?{}:_notification$web,abstractNotification=_objectWithoutProperties(notification,[\"web\"]);tag=web.tag||tag;var nativeNotification=_objectSpread({},abstractNotification,{tag:tag},web,{_isLocal:true});return[nativeNotification.title,nativeNotification];}function getRegistrationAsync(){return _getRegistrationAsync.apply(this,arguments);}function _getRegistrationAsync(){_getRegistrationAsync=_asyncToGenerator(_regeneratorRuntime.mark(function _callee11(){var registration;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:guardPermission();_context11.next=3;return navigator.serviceWorker.getRegistration();case 3:registration=_context11.sent;if(registration){_context11.next=6;break;}throw new Error('Failed to get notification registration!');case 6:return _context11.abrupt(\"return\",registration);case 7:case\"end\":return _context11.stop();}}},_callee11);}));return _getRegistrationAsync.apply(this,arguments);}function getNotificationsAsync(_x){return _getNotificationsAsync.apply(this,arguments);}function _getNotificationsAsync(){_getNotificationsAsync=_asyncToGenerator(_regeneratorRuntime.mark(function _callee12(tag){var registration,notifications;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return getRegistrationAsync();case 2:registration=_context12.sent;_context12.next=5;return registration.getNotifications(tag?{tag:tag}:undefined);case 5:notifications=_context12.sent;return _context12.abrupt(\"return\",notifications);case 7:case\"end\":return _context12.stop();}}},_callee12);}));return _getNotificationsAsync.apply(this,arguments);}export default{presentLocalNotification:function presentLocalNotification(notification){return _asyncToGenerator(_regeneratorRuntime.mark(function _callee(){var registration,tag;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getRegistrationAsync();case 2:registration=_context.sent;tag=uuidv4();registration.showNotification.apply(registration,_toConsumableArray(transformLocalNotification(notification,tag)));return _context.abrupt(\"return\",tag);case 6:case\"end\":return _context.stop();}}},_callee);}))();},scheduleLocalNotification:function scheduleLocalNotification(notification){var _arguments=arguments,_this=this;return _asyncToGenerator(_regeneratorRuntime.mark(function _callee2(){var options,registration,tag,intervalMs;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:options=_arguments.length>1&&_arguments[1]!==undefined?_arguments[1]:{};if(!options.intervalMs){_context2.next=10;break;}_context2.next=4;return getRegistrationAsync();case 4:registration=_context2.sent;tag=uuidv4();setTimeout(function(){registration.showNotification.apply(registration,_toConsumableArray(transformLocalNotification(notification,tag)));},options.intervalMs);return _context2.abrupt(\"return\",tag);case 10:if(!options.time){_context2.next=15;break;}intervalMs=options.time-Date.now();if(!(intervalMs<0)){_context2.next=14;break;}throw new Error('Expo.Notifications.scheduleLocalNotification(): options.time must be some time in the future.');case 14:return _context2.abrupt(\"return\",_this.scheduleLocalNotification(notification,{intervalMs:intervalMs}));case 15:throw new Error(\"Expo.Notifications.scheduleLocalNotification() options \".concat(JSON.stringify(options,null,2),\" are not supported yet.\"));case 16:case\"end\":return _context2.stop();}}},_callee2);}))();},dismissNotification:function dismissNotification(notificationId){return _asyncToGenerator(_regeneratorRuntime.mark(function _callee3(){var notifications,_iterator,_step,notification;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getNotificationsAsync(notificationId);case 2:notifications=_context3.sent;_iterator=_createForOfIteratorHelper(notifications);try{for(_iterator.s();!(_step=_iterator.n()).done;){notification=_step.value;notification.close();}}catch(err){_iterator.e(err);}finally{_iterator.f();}case 5:case\"end\":return _context3.stop();}}},_callee3);}))();},dismissAllNotifications:function dismissAllNotifications(){var _this2=this;return _asyncToGenerator(_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this2.dismissNotification();case 1:case\"end\":return _context4.stop();}}},_callee4);}))();},cancelScheduledNotificationAsync:function cancelScheduledNotificationAsync(notificationId){var _this3=this;return _asyncToGenerator(_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_this3.dismissNotification(notificationId);case 1:case\"end\":return _context5.stop();}}},_callee5);}))();},cancelAllScheduledNotificationsAsync:function cancelAllScheduledNotificationsAsync(){var _this4=this;return _asyncToGenerator(_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_this4.dismissNotification();case 1:case\"end\":return _context6.stop();}}},_callee6);}))();},getExponentPushTokenAsync:function getExponentPushTokenAsync(){return _asyncToGenerator(_regeneratorRuntime.mark(function _callee7(){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return _getExponentPushTokenAsync();case 2:return _context7.abrupt(\"return\",_context7.sent);case 3:case\"end\":return _context7.stop();}}},_callee7);}))();},getDevicePushTokenAsync:function getDevicePushTokenAsync(){return _asyncToGenerator(_regeneratorRuntime.mark(function _callee8(){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return _getDevicePushTokenAsync();case 2:return _context8.abrupt(\"return\",_context8.sent);case 3:case\"end\":return _context8.stop();}}},_callee8);}))();},getBadgeNumberAsync:function getBadgeNumberAsync(){return _asyncToGenerator(_regeneratorRuntime.mark(function _callee9(){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:return _context9.abrupt(\"return\",currentBadgeNumber);case 1:case\"end\":return _context9.stop();}}},_callee9);}))();},setBadgeNumberAsync:function setBadgeNumberAsync(badgeNumber){return _asyncToGenerator(_regeneratorRuntime.mark(function _callee10(){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:currentBadgeNumber=badgeNumber;badgin.set(badgeNumber);case 2:case\"end\":return _context10.stop();}}},_callee10);}))();}};","map":{"version":3,"sources":["../../src/Notifications/ExponentNotifications.web.ts"],"names":[],"mappings":"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","sourcesContent":["import * as badgin from 'badgin';\nimport uuidv4 from 'uuid/v4';\n\nimport {\n  guardPermission,\n  getExponentPushTokenAsync,\n  getDevicePushTokenAsync,\n} from './ExponentNotificationsHelper.web';\nimport { LocalNotification, LocalNotificationId } from './Notifications.types';\n\n// Register `message`'s event listener (side-effect)\nimport './ExponentNotifications.fx.web';\n\nlet currentBadgeNumber = 0;\n\nfunction transformLocalNotification(\n  notification: LocalNotification,\n  tag: string\n): [string, NotificationOptions] {\n  const { web = {}, ...abstractNotification } = notification;\n  tag = web.tag || tag;\n  const nativeNotification = {\n    ...abstractNotification,\n    tag,\n    ...web,\n    // Show that this notification is a local notification\n    _isLocal: true,\n  };\n  return [nativeNotification.title, nativeNotification];\n}\n\nasync function getRegistrationAsync(): Promise<ServiceWorkerRegistration> {\n  guardPermission();\n  const registration = await navigator.serviceWorker.getRegistration();\n  if (!registration) {\n    throw new Error('Failed to get notification registration!');\n  }\n  return registration;\n}\n\nasync function getNotificationsAsync(tag?: string): Promise<Notification[]> {\n  const registration = await getRegistrationAsync();\n  const notifications = await registration.getNotifications(tag ? { tag } : undefined);\n  return notifications;\n}\n\nexport default {\n  async presentLocalNotification(notification: LocalNotification): Promise<LocalNotificationId> {\n    const registration = await getRegistrationAsync();\n    const tag = uuidv4();\n    registration.showNotification(...transformLocalNotification(notification, tag));\n    return tag;\n  },\n  async scheduleLocalNotification(\n    notification: any,\n    options: {\n      time?: Date | number;\n      repeat?: 'minute' | 'hour' | 'day' | 'week' | 'month' | 'year';\n      intervalMs?: number;\n    } = {}\n  ): Promise<string> {\n    if (options.intervalMs) {\n      const registration = await getRegistrationAsync();\n      const tag = uuidv4();\n      setTimeout(() => {\n        registration.showNotification(...transformLocalNotification(notification, tag));\n      }, options.intervalMs);\n      return tag;\n    } else if (options.time) {\n      const intervalMs = (options.time as number) - Date.now();\n      if (intervalMs < 0) {\n        throw new Error(\n          'Expo.Notifications.scheduleLocalNotification(): options.time must be some time in the future.'\n        );\n      }\n      return this.scheduleLocalNotification(notification, {\n        intervalMs,\n      });\n    }\n    throw new Error(\n      `Expo.Notifications.scheduleLocalNotification() options ${JSON.stringify(\n        options,\n        null,\n        2\n      )} are not supported yet.`\n    );\n  },\n\n  async dismissNotification(notificationId?: string): Promise<void> {\n    const notifications = await getNotificationsAsync(notificationId);\n    for (const notification of notifications) {\n      notification.close();\n    }\n  },\n  async dismissAllNotifications(): Promise<void> {\n    this.dismissNotification();\n  },\n  async cancelScheduledNotificationAsync(notificationId: string): Promise<void> {\n    this.dismissNotification(notificationId);\n  },\n  async cancelAllScheduledNotificationsAsync(): Promise<void> {\n    this.dismissNotification();\n  },\n\n  async getExponentPushTokenAsync(): Promise<string> {\n    return await getExponentPushTokenAsync();\n  },\n\n  async getDevicePushTokenAsync(): Promise<{ type: string; data: object }> {\n    return await getDevicePushTokenAsync();\n  },\n\n  async getBadgeNumberAsync(): Promise<number> {\n    return currentBadgeNumber;\n  },\n\n  async setBadgeNumberAsync(badgeNumber: number): Promise<void> {\n    currentBadgeNumber = badgeNumber;\n    badgin.set(badgeNumber);\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}